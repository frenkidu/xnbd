<!doctype refentry PUBLIC "-//OASIS//DTD DocBook V4.5//EN" [

<!-- Process this file with docbook-to-man to generate an nroff manual
     page: `docbook-to-man manpage.sgml > manpage.1'.  You may view
     the manual page with: `docbook-to-man manpage.sgml | nroff -man |
     less'.  A typical entry in a Makefile or Makefile.am is:

manpage.1: manpage.sgml
	docbook-to-man $< > $@
  -->

  <!-- Fill in your name for FIRSTNAME and SURNAME. -->
  <!ENTITY dhfirstname "<firstname>Arno</firstname>">
  <!ENTITY dhsurname   "<surname>Toell</surname>">
  <!-- Please adjust the date whenever revising the manpage. -->
  <!ENTITY dhdate      "<date>$Date$</date>">
  <!-- SECTION should be 1-8, maybe w/ subsection other parameters are
       allowed: see man(7), man(1). -->
  <!ENTITY dhsection   "<manvolnum>1</manvolnum>">
  <!ENTITY dhemail     "<email>debian@toell.net</email>">
  <!ENTITY dhusername  "Arno Toell">
  <!ENTITY dhucpackage "<refentrytitle>XNBD-BGCTL</refentrytitle>">
  <!ENTITY dhpackage   "xnbd-bgctl">

  <!ENTITY debian      "<productname>Debian GNU/Linux</productname>">
  <!ENTITY gnu         "<acronym>GNU</acronym>">
]>

<refentry>
  <refentryinfo>
    <address>
      &dhemail;
    </address>
    <author>
      &dhfirstname;
      &dhsurname;
    </author>
    <copyright>
      <year>2012</year>
      <holder>&dhusername;</holder>
    </copyright>
    &dhdate;
  </refentryinfo>
  <refmeta>
    &dhucpackage;

    &dhsection;
  </refmeta>
  <refnamediv>
    <refname>&dhpackage;</refname>

    <refpurpose>Control a server running <command>xnbd-server</command>(8)
    through its control socket</refpurpose>
  </refnamediv>

  <refsynopsisdiv>
    <cmdsynopsis>
      <command>&dhpackage;</command>
      <arg>--cache-all</arg>
      <arg>--cache-all2</arg>
      <arg>--query</arg>
      <arg>--reconnect <replaceable>REMOTE_HOST</replaceable>
      <replaceable>REMOTE_PORT</replaceable></arg>
      <arg>--shutdown</arg>
      <arg><replaceable>control_socket</replaceable></arg>
    </cmdsynopsis>
  </refsynopsisdiv>
  <refsect1>
    <title>DESCRIPTION</title>
    <para>With the <command>xmbd-bgctl</command> command you can connect to a <command>xnbd-server</command> control
    channel and instruct it to act as directed. You may pass an argument to the control program which is then forwarded,
    on your behalf, to the server instance.</para>
  </refsect1>
  <refsect1>
    <title>OPTIONS</title>

    <para>The following options are supported:</para>

    <variablelist>
      <varlistentry>
	<term><option>--cache-all</option></term>
	<listitem>
	  <para>If the remote xnbd-server acts as proxy server, this command intstructs
          the controlling <command>xnbd-server</command> instance to cache all blocks on its
          associated block disk. Upon completion the controlled xnbd instance holds all
          data from the origin instance and it is no longer necessary to act as proxy.</para>
	</listitem>
      </varlistentry>
      <varlistentry>
      	<term><option>--cache-all2</option></term>
	<listitem>
	<para>This command is identical to
	<option>cache-all</option> but detaches the process from the terminal
	and is hence using a dedicated connection for data transfer.</para>
        </listitem>
      </varlistentry>


      <varlistentry>
      	<term><option>--query</option></term>
	<listitem>
	<para>This command retrieves completion statistics
	from the proxy server instance. It returns the number of cached blocks
	on the server.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
      	<term><option>--reconnect</option></term>
	<listitem>
	<para>This command recovers from a lost connection by re-establishing
	connectivity with the origin server. This command expects two additional
	arguments, the <replaceable>REMOTE_HOST</replaceable>, and the
	<replaceable>REMOTE_PORT</replaceable>
	you want to connect to, to recover from a disconnected session. </para>
        </listitem>
      </varlistentry>


      <varlistentry>
      	<term><option>--shutdown</option></term>
	<listitem>
	<para>This command stops the proxy server and restarts the target server.
	All client sessions are preserved.</para>
        </listitem>
      </varlistentry>

    </variablelist>
  </refsect1>
  <refsect1>
    <title>POSITIONAL ARGUMENTS</title>

    <para>The following positional options are supported:</para>

    <variablelist>
        <varlistentry>
        <term><option>CONTROL_SOCKET</option></term>
        <listitem>
          <para>The Unix domain socket, the <command>xnbd-server</command>(8)
	  program is listening on.</para>
        </listitem>
      </varlistentry>
      </variablelist>
  </refsect1>

  <refsect1>
    <title>SEE ALSO</title>

    <para>xnbd-server (8).</para>

  </refsect1>
  <refsect1>
    <title>AUTHOR</title>
    <para>The NBD kernel module and the NBD tools have been written by
    Pavel Macheck (pavel@ucw.cz) and is now maintained by Paul Clements.
    (Paul.Clements@steeleye.com).</para>

    <para>The xNBD userland (client and server) have been written by 
     Takahiro Hirofuchi (t.hirofuchi@aist.go.jp)</para>

    <para>This manual page was written by &dhusername; (&dhemail;) for
    the &debian; system (but may be used by others). Permission is
    granted to copy, distribute and/or modify this document under the
    terms of the <acronym>GNU</acronym> General Public License,
    version 2, as published by the Free Software Foundation.</para>

  </refsect1>
</refentry>

